<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vehicle Inventory Management</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>

<body>
  <div class="dashboard-container" *ngIf="user">
    <!-- Welcome Section -->
  <div class="welcome-section">
    <h1><i class="fas fa-user-circle"></i> Welcome, {{ user.username }}</h1>
  </div>

  <!-- Brand Filter Section -->
  <div class="brand-filters">
    <div *ngIf="hasRole('TATA')" class="brand-item" [class.active]="selectedMake === 'Tata'" (click)="filterByMake('Tata')">
      <i class="fas fa-car"></i>
      <span>Tata</span>
    </div>
    <div *ngIf="hasRole('EICHER')" class="brand-item" [class.active]="selectedMake === 'Eicher'" (click)="filterByMake('Eicher')">
      <i class="fas fa-truck"></i>
      <span>Eicher</span>
    </div>
    <div *ngIf="hasRole('TOYOTA')" class="brand-item" [class.active]="selectedMake === 'Toyota'" (click)="filterByMake('Toyota')">
      <i class="fas fa-car-side"></i>
      <span>Toyota</span>
    </div>
    <div *ngIf="hasRole('ADMIN')" class="brand-item" [class.active]="!selectedMake" (click)="filterByMake('')">
      <i class="fas fa-list"></i>
      <span>All</span>
    </div>
  </div>

  <!-- Stats Section -->
<div class="stats-section">
  <div class="stats-container">
    <!-- Total Stats -->
    <!-- Total Stats -->
<div class="total-stats">
  <div class="stat-card primary">
    <div class="stat-header">
      <div class="stat-icon">
        <i class="fas fa-car-alt"></i>
      </div>
      <div class="stat-badge">
        <span>Total</span>
      </div>
    </div>
    <div class="stat-content">
      <h3>Total Vehicles</h3>
      <p class="stat-value">{{ getTotalCarsAvailable() }}</p>
      <div class="stat-footer">
        <span class="trend-up" *ngIf="getTotalCarsAvailable() > 0">
          <i class="fas fa-arrow-up"></i>
          Active Fleet
        </span>
      </div>
    </div>
  </div>
</div>
    
    <!-- City Stats with Slider -->
    <div class="city-stats">
      <button class="scroll-button left" (click)="scrollLeft()" *ngIf="showLeftScroll">
        <i class="fas fa-chevron-left"></i>
      </button>
      
      <div class="stats-slider" #cityStatsContainer>
        <div class="stat-card" *ngFor="let cityData of getCityWiseModelCounts()">
          <div class="stat-icon">
            <i class="fas fa-city"></i>
          </div>
          <div class="stat-content">
            <h3>{{ cityData.city }}</h3>
            <a routerLink="" class="hidelink"><p class="stat-value">{{ cityData.count }}</p></a>
            <p class="stat-label">Vehicles</p>
          </div>
        </div>
      </div>

      <button class="scroll-button right" (click)="scrollRight()" *ngIf="showRightScroll">
        <i class="fas fa-chevron-right"></i>
      </button>
    </div>
  </div>
</div>

  <!-- Search Section -->
  <div class="search-section">
    <div class="search-container">
      <div class="search-wrapper">
        <i class="fas fa-search"></i>
        <input 
          type="text" 
          placeholder="Search vehicles by make, model, or city..." 
          [(ngModel)]="searchTerm"
          (input)="filterStocks()" 
          class="search-input"
        />
        <!-- <button class="search-clear" *ngIf="searchTerm" (click)="clearSearch()">
          <i class="fas fa-times"></i>
        </button> -->
      </div>
    </div>
  </div>
  <div *ngIf="successMessage" class="small-success-message">
    <p>{{ successMessage }}</p>
</div>
  <!-- Vehicle Grid -->
  <div class="vehicle-grid">
    <div class="vehicle-card" *ngFor="let stock of filteredStocksList">
      <div class="card-header">
        <i class="fas fa-car"></i>
        <h3>{{ stock.make }}</h3>
      </div>
      <div class="card-content">
        <div class="detail-row">
          <span class="label">Model:</span>
          <a [routerLink]="['/vehicle-page', stock.model]">{{ stock.model }}</a>
        </div>
        <!-- <div class="detail-row">
          <span class="label">Location:</span>
          <span>{{ stock.location }}</span>
        </div> -->
       <!-- Replace the commented age section with this -->
<!-- Replace the age section with this corrected version -->
<div class="detail-row">
  <span class="label">Age:</span>
  <span [class]="'age-badge ' + calculateVehicleAge(stock.receivedDate).status">
    {{ calculateVehicleAge(stock.receivedDate).days }} days
    <span class="age-label">{{ calculateVehicleAge(stock.receivedDate).label }}</span>
  </span>
</div>
        <div class="detail-row">
          <span class="label">Date:</span>
          <span>{{ stock.receivedDate | date: 'dd-MM-yyyy' }}</span>
        </div>
      </div>
      <div class="card-actions">
        <button class="btn-edit" (click)="openEditVehiclePopup(stock)">
          <i class="fas fa-edit"></i> Edit
        </button>
        <button class="btn-delete" (click)="onDelete(stock)">
          <i class="fas fa-trash"></i> Delete
        </button>
      </div>
    </div>
  </div>

    <!-- Add Vehicle Popup -->
    <div *ngIf="showPopup" class="popup">
      <div class="popup-content">
        <span class="close" (click)="closePopup()">&times;</span>
        <h2>Add Vehicle</h2>
        <!-- Success message -->
        <div *ngIf="successMessage" class="small-success-message">
          <p>{{ successMessage }}</p>
        </div>
        <form [formGroup]="vehicleForm" (ngSubmit)="onSubmit()">
          <label for="make">Make:</label>
          <input id="make" formControlName="make" placeholder="Enter vehicle make">

          <label for="model">Model:</label>
          <input id="model" formControlName="model" placeholder="Enter vehicle model">

          <label for="city">City:</label>
          <input id="city" formControlName="city" placeholder="Enter city">

          <label for="vehicleYear">Vehicle Year:</label>
          <input id="vehicleYear" formControlName="vehicleYear" type="date">

          <button type="submit" class="button">Submit</button>
        </form>
      </div>
    </div>

    <!-- Edit Vehicle Popup -->
    <div *ngIf="showEditPopup" class="popup">
      <div class="popup-content">
        <!-- Success message -->
        <div *ngIf="successMessage" class="small-success-message">
          <p>{{ successMessage }}</p>
        </div>
        <span class="close" (click)="closeEditPopup()">&times;</span>
        <h2>Edit Vehicle</h2>
        <form (ngSubmit)="onUpdate()">
          <label for="editVehicleMake">Make:</label>
          <input type="text" id="editVehicleMake" [(ngModel)]="editVehicleData.make" name="make"
            placeholder="Enter vehicle make" required>

          <label for="editVehicleModel">Model:</label>
          <input type="text" id="editVehicleModel" [(ngModel)]="editVehicleData.model" name="model"
            placeholder="Enter vehicle model" required>

          <label for="editVehicleCity">City:</label>
          <input type="text" id="editVehicleCity" [(ngModel)]="editVehicleData.location" name="city"
            placeholder="Enter city" required>

          <label for="editVehicleYear">Vehicle Year:</label>
          <input type="date" id="editVehicleYear" [(ngModel)]="editVehicleData.receivedDate" name="vehicleYear" required>

          <button type="submit" class="button">Update Vehicle</button>
        </form>
      </div>
    </div>

  </div>
</body>

</html>
